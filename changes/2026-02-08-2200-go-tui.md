# Go TUI Thin Client (PR #12)

## Why

With the daemon handling all backend work, the TUI becomes a pure display layer. Rewriting it in Go (bubbletea) gives us:

- Fast startup (compiled binary, no Swift runtime overhead)
- The Elm architecture (Model/Update/View) for predictable state management
- Rich ecosystem of TUI components (bubbletea, lipgloss, bubbles)
- Independence from the Swift toolchain for the frontend

## How

Created `tui/` — a Go module containing a bubbletea-based TUI that connects to steno-daemon via Unix socket and reads topics from SQLite.

### Architecture

```
steno-tui (Go/bubbletea)
├── main.go                  # Entry point, bubbletea program
├── internal/app/
│   ├── model.go             # Root Model (Init/Update/View)
│   ├── messages.go          # All tea.Msg types
│   └── keymap.go            # Key bindings
├── internal/daemon/
│   ├── client.go            # Unix socket client (Connect, SendCommand, ReadEvent)
│   └── protocol.go          # Command/Response/Event structs (mirrors DaemonProtocol.swift)
├── internal/db/
│   ├── store.go             # SQLite read-only queries (modernc.org/sqlite, no CGo)
│   └── models.go            # Go structs for DB tables
└── internal/ui/
    └── styles.go            # Lipgloss styles (colors, label styles)
```

### Dual Socket Connections

The TUI opens two socket connections to the daemon:
1. **Command connection** — sends start/stop/status/devices, receives synchronous responses
2. **Event connection** — sends subscribe, receives streaming NDJSON events

This avoids interleaving command responses with event data on a single connection.

### Features

- Live transcript with `[MIC]`/`[SYS]` labels, color-coded by source
- Partial text in yellow with `▌` cursor
- Real-time audio level meters (green/yellow/gray gradient)
- Topic panel with j/k navigation, Enter to expand summaries
- Tab to switch panel focus (topics ↔ transcript)
- Transcript scrolling with LIVE/SCROLL mode indicator
- Auto-reconnect on daemon disconnect (2s backoff, max 30s)
- Device cycling and system audio toggle
- Long-line text wrapping in transcript panel

### Dependencies

- `github.com/charmbracelet/bubbletea` — Elm-architecture TUI framework
- `github.com/charmbracelet/lipgloss` — Terminal styling
- `modernc.org/sqlite` — Pure-Go SQLite (no CGo), read-only access

## Key Decisions

- **Pure Go SQLite** — `modernc.org/sqlite` compiles SQLite to Go, avoiding CGo. This means `go build` produces a static binary with zero C dependencies.
- **Dual connections** — Simpler than multiplexing command responses and events on a single socket. Each connection has a clear purpose.
- **Source-consistent colors** — `[MIC]` labels are green, `[SYS]` labels are cyan, matching the level meter colors. Partial text stays yellow regardless of source for visual consistency.
- **No bubbles viewport** — Custom scroll implementation because the transcript panel needs LIVE/SCROLL mode semantics (auto-scroll in LIVE, manual in SCROLL, auto-resume at bottom).

## Testing

- 37 Go tests across 4 packages (daemon protocol, socket client, SQLite store, app model)
- Live integration tests that connect to a running daemon (skipped if daemon not running)
- Crash regression tests for malformed NDJSON handling

## What's Next

- Remove the legacy Swift TUI once the Go TUI is stable
- Add clipboard copy for selected transcript segments
- Session history browser
